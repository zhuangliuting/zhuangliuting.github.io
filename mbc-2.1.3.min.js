/**
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Mobile Browser Capture
 * @website http://www.dynamsoft.com
 * @preserve Copyright 2018, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 2.1.3
 * @fileoverview Dynamsoft JavaScript Library for Basic Image Edit
 * More info on MBC: http://www.dynamsoft.com/
 */
var $jscomp={scope:{},findInternal:function(b,a,c){b instanceof String&&(b=String(b));for(var d=b.length,u=0;u<d;u++){var w=b[u];if(a.call(c,w,u,b))return{i:u,v:w}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[a]=c.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,a,c,d){if(a){c=$jscomp.global;b=b.split(".");for(d=0;d<b.length-1;d++){var u=b[d];u in c||(c[u]={});c=c[u]}b=b[b.length-1];d=c[b];a=a(d);a!=d&&null!=a&&$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:a})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6-impl","es3");$jscomp.polyfill("Math.sign",function(b){return b?b:function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.fill",function(b){return b?b:function(a,b,d){var c=this.length||0;0>b&&(b=Math.max(0,c+b));if(null==d||d>c)d=c;d=Number(d);0>d&&(d=Math.max(0,c+d));for(b=Number(b||0);b<d;b++)this[b]=a;return this}},"es6-impl","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;
$jscomp.Symbol=function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(b){var a=0;return $jscomp.iteratorPrototype(function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}})};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.makeIterator=function(b){$jscomp.initSymbolIterator();var a=b[Symbol.iterator];return a?a.call(b):$jscomp.arrayIterator(b)};$jscomp.EXPOSE_ASYNC_EXECUTOR=!0;$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(b){function a(){this.batch_=null}if(b&&!$jscomp.FORCE_POLYFILL_PROMISE)return b;a.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};a.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var c=$jscomp.global.setTimeout;a.prototype.asyncExecuteFunction=function(a){c(a,0)};a.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];delete a[b];try{c()}catch(h){this.asyncThrow_(h)}}}this.batch_=null};a.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var d=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(z){b.reject(z)}};d.prototype.createResolveAndReject_=function(){function a(a){return function(h){c||(c=!0,a.call(b,h))}}var b=this,c=
!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};d.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof d)this.settleSameAsPromise_(a);else{var b;a:switch(typeof a){case "object":b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};d.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(z){this.reject_(z);return}"function"==
typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};d.prototype.reject_=function(a){this.settle_(2,a)};d.prototype.fulfill_=function(a){this.settle_(1,a)};d.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};d.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),
a[b]=null;this.onSettledCallbacks_=null}};var u=new a;d.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};d.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(h){c.reject(h)}};d.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{h(a(b))}catch(Q){g(Q)}}:b}var h,g,n=new d(function(a,b){h=a;g=b});this.callWhenSettled_(c(a,h),
c(b,g));return n};d.prototype["catch"]=function(a){return this.then(void 0,a)};d.prototype.callWhenSettled_=function(a,b){function c(){switch(h.state_){case 1:a(h.result_);break;case 2:b(h.result_);break;default:throw Error("Unexpected state: "+h.state_);}}var h=this;null==this.onSettledCallbacks_?u.asyncExecute(c):this.onSettledCallbacks_.push(function(){u.asyncExecute(c)})};d.resolve=function(a){return a instanceof d?a:new d(function(b,c){b(a)})};d.reject=function(a){return new d(function(b,c){c(a)})};
d.race=function(a){return new d(function(b,c){for(var h=$jscomp.makeIterator(a),g=h.next();!g.done;g=h.next())d.resolve(g.value).callWhenSettled_(b,c)})};d.all=function(a){var b=$jscomp.makeIterator(a),c=b.next();return c.done?d.resolve([]):new d(function(a,g){function h(b){return function(c){w[b]=c;A--;0==A&&a(w)}}var w=[],A=0;do w.push(void 0),A++,d.resolve(c.value).callWhenSettled_(h(w.length-1),g),c=b.next();while(!c.done)})};$jscomp.EXPOSE_ASYNC_EXECUTOR&&(d.$jscomp$new$AsyncExecutor=function(){return new a});
return d},"es6-impl","es3");var kUtil=kUtil||{};Math.sign||(Math.sign=function(b){return 0<b?1:0==b?0>1/b?-0:0:0>b?-1:NaN});kUtil.Matrix=function(b,a,c,d,u,w){this.a=b;this.b=a;this.c=c;this.d=d;this.e=u;this.f=w};kUtil.Matrix.dot=function(b,a){return new kUtil.Matrix(b.a*a.a+b.c*a.b,b.b*a.a+b.d*a.b,b.a*a.c+b.c*a.d,b.b*a.c+b.d*a.d,b.a*a.e+b.c*a.f+b.e,b.b*a.e+b.d*a.f+b.f)};kUtil.Matrix.prototype.dot=function(b){return kUtil.Matrix.dot(this,b)};
kUtil.Matrix.equals=function(b,a){return b.a==a.a&&b.b==a.b&&b.c==a.c&&b.d==a.d&&b.e==a.e&&b.f==a.f};kUtil.Matrix.prototype.equals=function(b){return kUtil.Matrix.equals(this,b)};kUtil.Matrix.prototype.inversion=function(){var b=this.a,a=this.b,c=this.c,d=this.d,u=this.e,w=this.f,P=b*d-a*c;return new kUtil.Matrix(d/P,-a/P,-c/P,b/P,(c*w-d*u)/P,(a*u-b*w)/P)};
kUtil.convertURLToBlob=function(b,a){var c=new XMLHttpRequest;c.open("GET",b,!0);c.responseType="blob";c.onloadend=function(){a(this.response)};c.send()};kUtil.convertBase64ToBlob=function(b,a){for(var c=atob(b),d=Array(c.length),u=0;u<c.length;++u)d[u]=c.charCodeAt(u);c=new Uint8Array(d);return new Blob([c],{type:a})};
Date.prototype.kUtilFormat=function(b){var a={"M+":this.getUTCMonth()+1,"d+":this.getUTCDate(),"h+":this.getUTCHours(),"m+":this.getUTCMinutes(),"s+":this.getUTCSeconds(),"q+":Math.floor((this.getUTCMonth()+3)/3),S:this.getUTCMilliseconds()};/(y+)/.test(b)&&(b=b.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var c in a)(new RegExp("("+c+")")).test(b)&&(b=b.replace(RegExp.$1,1==RegExp.$1.length?a[c]:("00"+a[c]).substr((""+a[c]).length)));return b};
kUtil.copyToClipBoard=function(b){if(navigator.clipboard)navigator.clipboard.writeText(b)["catch"](function(a){alert("copy failed, info: "+(a.message||a))});else{var a=document.createElement("textarea");a.style.width="4px";a.style.height="4px";a.style.position="fixed";a.style.left="0";a.style.top="0";$(document.body).append(a);a.value=b;if(b=navigator.userAgent.match(/ipad|iphone/i)){var c=document.createRange();c.selectNodeContents(a);var d=window.getSelection();d.removeAllRanges();d.addRange(c);
a.setSelectionRange(0,999999)}else a.focus(),a.select();try{document.execCommand("copy")||b||alert("copy failed")}catch(u){alert("copy failed, info: "+(u.message||u))}$(a).remove()}};
(function(b){b.fn.borderWidth=function(){var a;a=window.getComputedStyle?getComputedStyle(this[0]):this[0].currentStyle;var b={};b.left=parseFloat(a.getPropertyValue?a.getPropertyValue("border-left-width"):a.getAttribute("border-left-width"))||0;b.top=parseFloat(a.getPropertyValue?a.getPropertyValue("border-top-width"):a.getAttribute("border-top-width"))||0;b.right=parseFloat(a.getPropertyValue?a.getPropertyValue("border-right-width"):a.getAttribute("border-right-width"))||0;b.bottom=parseFloat(a.getPropertyValue?
a.getPropertyValue("border-bottom-width"):a.getAttribute("border-bottom-width"))||0;return b};b.fn.padding=function(){var a;a=window.getComputedStyle?getComputedStyle(this[0]):this[0].currentStyle;var b={};b.left=parseFloat(a.getPropertyValue?a.getPropertyValue("padding-left"):a.getAttribute("padding-left"))||0;b.top=parseFloat(a.getPropertyValue?a.getPropertyValue("padding-top"):a.getAttribute("padding-top"))||0;b.right=parseFloat(a.getPropertyValue?a.getPropertyValue("padding-right"):a.getAttribute("padding-right"))||
0;b.bottom=parseFloat(a.getPropertyValue?a.getPropertyValue("padding-bottom"):a.getAttribute("padding-bottom"))||0;return b};b.fn.borderBoxRect=function(){var a=null;window.getComputedStyle&&(a=getComputedStyle(this[0]));var b=this.offset(),d={};d.pageX0=b.left;d.pageY0=b.top;d.width=a?parseFloat(a.width):this.outerWidth();d.height=a?parseFloat(a.height):this.outerHeight();d.pageX1=d.pageX0+d.width;d.pageY1=d.pageY0+d.height;return d};b.fn.paddingBoxRect=function(){var a=this.borderBoxRect(),b=this.borderWidth(),
d={};d.pageX0=a.pageX0+b.left;d.pageY0=a.pageY0+b.top;d.width=window.getComputedStyle?a.width-(b.left+b.right):this.innerWidth();d.height=window.getComputedStyle?a.height-(b.top+b.bottom):this.innerHeight();d.pageX1=a.pageX1-b.right;d.pageY1=a.pageY1-b.bottom;return d};b.fn.contentBoxRect=function(){var a=this.paddingBoxRect(),b=this.padding(),d={};d.pageX0=a.pageX0+b.left;d.pageY0=a.pageY0+b.top;d.width=window.getComputedStyle?a.width-(b.left+b.right):this.width();d.height=window.getComputedStyle?
a.height-(b.top+b.bottom):this.height();d.pageX1=a.pageX1-b.right;d.pageY1=a.pageY1-b.bottom;return d};b.fn.getTransform=function(){var a=this.css("transform");if("none"==a||""==a)a=this[0].style.transform;var b="matrix(",d=a.indexOf(b);if(-1!=d){d+=b.length;a=a.substring(d,a.indexOf(")",d)).split(",");for(b=0;b<a.length;++b)a[b]=parseFloat(a[b]);return new kUtil.Matrix(a[0],a[1],a[2],a[3],a[4],a[5])}b="scale(";d=a.indexOf(b);return-1!=d?(d+=b.length,a=parseFloat(a.substring(d)),new kUtil.Matrix(a,
0,0,a,0,0)):new kUtil.Matrix(1,0,0,1,0,0)};b.fn.setTransform=function(a){a="matrix("+[a.a,a.b,a.c,a.d,a.e,a.f].join()+")";this.css("transform",a)}})(jQuery);var TaskQueue=function(){this._queue=[];this.isWorking=!1;this.timeout=100};TaskQueue.prototype.push=function(b,a,c){this._queue.push({task:b,context:a,args:c});this.isWorking||this.next()};TaskQueue.prototype.unshift=function(b,a,c){this._queue.unshift({task:b,context:a,args:c});this.isWorking||this.next()};
TaskQueue.prototype.next=function(){if(0==this._queue.length)this.isWorking=!1;else{this.isWorking=!0;var b=this._queue.shift(),a=b.task,c=b.context?b.context:self,d=b.args?b.args:[];setTimeout(function(){a.apply(c,d)},this.timeout)}};
(function(){function b(a,b){b||a.match(/^data\:([^\;]+)\;base64,/mi);a=a.replace(/^data\:([^\;]+)\;base64,/gmi,"");for(var v=atob(a),h=v.length,d=new ArrayBuffer(h),k=new Uint8Array(d),t=0;t<h;t++)k[t]=v.charCodeAt(t);return d}function a(a,b){var v=new XMLHttpRequest;v.open("GET",a,!0);v.responseType="blob";v.onload=function(a){200!=this.status&&0!==this.status||b(this.response)};v.send()}function c(v,h){function c(a){var b=d(a),t;a:if(t=new DataView(a),255!=t.getUint8(0)||216!=t.getUint8(1))t=!1;
else{for(var k=2,c=a.byteLength;k<c;){var y=t,g=k;if(56===y.getUint8(g)&&66===y.getUint8(g+1)&&73===y.getUint8(g+2)&&77===y.getUint8(g+3)&&4===y.getUint8(g+4)&&4===y.getUint8(g+5)){y=t.getUint8(k+7);0!==y%2&&(y+=1);0===y&&(y=4);var c=k+8+y,k=t.getUint16(k+6+y),n,O;t=c;c=new DataView(a);y={};for(g=t;g<t+k;)28===c.getUint8(g)&&2===c.getUint8(g+1)&&(n=c.getUint8(g+2),n in T&&(O=c.getInt16(g+3),n=T[n],O=P(c,g+5,O),y.hasOwnProperty(n)?y[n]instanceof Array?y[n].push(O):y[n]=[y[n],O]:y[n]=O)),g++;t=y;break a}k++}t=
void 0}var w;a:if("DOMParser"in self)if(k=new DataView(a),255!=k.getUint8(0)||216!=k.getUint8(1))w=!1;else{c=2;y=a.byteLength;for(a=new DOMParser;c<y-4;)if("http"==P(k,c,4)){y=c-1;c=k.getUint16(c-2)-1;k=P(k,y,c);c=k.indexOf("xmpmeta>")+8;k=k.substring(k.indexOf("<x:xmpmeta"),c);c=k.indexOf("x:xmpmeta")+10;k=k.slice(0,c)+'xmlns:Iptc4xmpCore="http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tiff="http://ns.adobe.com/tiff/1.0/" xmlns:plus="http://schemas.android.com/apk/lib/com.google.android.gms.plus" xmlns:ext="http://www.gettyimages.com/xsltExtension/1.0" xmlns:exif="http://ns.adobe.com/exif/1.0/" xmlns:stEvt="http://ns.adobe.com/xap/1.0/sType/ResourceEvent#" xmlns:stRef="http://ns.adobe.com/xap/1.0/sType/ResourceRef#" xmlns:crs="http://ns.adobe.com/camera-raw-settings/1.0/" xmlns:xapGImg="http://ns.adobe.com/xap/1.0/g/img/" xmlns:Iptc4xmpExt="http://iptc.org/std/Iptc4xmpExt/2008-02-29/" '+
k.slice(c);b:{a=a.parseFromString(k,"text/xml");try{k={};if(0<a.children.length)for(c=0;c<a.children.length;c++){var Y=a.children.item(c),A=Y.attributes,z;for(z in A){var q=A[z],l=q.nodeName,B=q.nodeValue;void 0!==l&&(k[l]=B)}var f=Y.nodeName;if("undefined"==typeof k[f])k[f]=xml2json(Y);else{if("undefined"==typeof k[f].push){var e=k[f];k[f]=[];k[f].push(e)}k[f].push(xml2json(Y))}}else k=a.textContent;w=k;break b}catch(p){console.log(p.message)}w=void 0}break a}else c++;w=void 0}else w=void 0;v.exifdata=
b||{};v.iptcdata=t||{};v.xmpdata=w||{};h&&h.call(v)}if(v.src)if(/^data\:/i.test(v.src)){var y=b(v.src);c(y)}else if(/^blob\:/i.test(v.src)){var g=new FileReader;g.onload=function(a){c(a.target.result)};a(v.src,function(a){g.readAsArrayBuffer(a)})}else{var k=new XMLHttpRequest;k.onload=function(){if(200==this.status||0===this.status)c(k.response);else throw"Could not load image";k=null};k.open("GET",v.src,!0);k.responseType="arraybuffer";k.send(null)}else self.FileReader&&(v instanceof self.Blob||
v instanceof self.File)&&(g=new FileReader,g.onload=function(a){c(a.target.result)},g.readAsArrayBuffer(v))}function d(a){var b=new DataView(a);if(255!=b.getUint8(0)||216!=b.getUint8(1))return!1;var c=2;a=a.byteLength;for(var v;c<a;){if(255!=b.getUint8(c))return!1;v=b.getUint8(c+1);if(225==v)return z(b,c+4,b.getUint16(c+2)-2);c+=2+b.getUint16(c+2)}}function u(a,b,c,h,d){var k=a.getUint16(c,!d),t={},v,y,g;for(g=0;g<k;g++)v=c+12*g+2,y=h[a.getUint16(v,!d)],t[y]=w(a,v,b,c,d);return t}function w(a,b,c,
h,d){var k=a.getUint16(b+2,!d);h=a.getUint32(b+4,!d);c=a.getUint32(b+8,!d)+c;var t,x;switch(k){case 1:case 7:if(1==h)return a.getUint8(b+8,!d);c=4<h?c:b+8;b=[];for(k=0;k<h;k++)b[k]=a.getUint8(c+k);return b;case 2:return P(a,4<h?c:b+8,h-1);case 3:if(1==h)return a.getUint16(b+8,!d);c=2<h?c:b+8;b=[];for(k=0;k<h;k++)b[k]=a.getUint16(c+2*k,!d);return b;case 4:if(1==h)return a.getUint32(b+8,!d);b=[];for(k=0;k<h;k++)b[k]=a.getUint32(c+4*k,!d);return b;case 5:if(1==h)return t=a.getUint32(c,!d),x=a.getUint32(c+
4,!d),a=new Number(t/x),a.numerator=t,a.denominator=x,a;b=[];for(k=0;k<h;k++)t=a.getUint32(c+8*k,!d),x=a.getUint32(c+4+8*k,!d),b[k]=new Number(t/x),b[k].numerator=t,b[k].denominator=x;return b;case 9:if(1==h)return a.getInt32(b+8,!d);b=[];for(k=0;k<h;k++)b[k]=a.getInt32(c+4*k,!d);return b;case 10:if(1==h)return a.getInt32(c,!d)/a.getInt32(c+4,!d);b=[];for(k=0;k<h;k++)b[k]=a.getInt32(c+8*k,!d)/a.getInt32(c+4+8*k,!d);return b}}function P(a,b,c){for(var h="",d=b;d<b+c;d++)h+=String.fromCharCode(a.getUint8(d));
return h}function z(a,b){if("Exif"!=P(a,b,4))return!1;var c,h,d,k,t=b+6;if(18761==a.getUint16(t))c=!1;else if(19789==a.getUint16(t))c=!0;else return!1;if(42!=a.getUint16(t+2,!c))return!1;var x=a.getUint32(t+4,!c);if(8>x)return!1;h=u(a,t,t+x,E,c);if(h.ExifIFDPointer)for(d in k=u(a,t,t+h.ExifIFDPointer,n,c),k){switch(d){case "LightSource":case "Flash":case "MeteringMode":case "ExposureProgram":case "SensingMethod":case "SceneCaptureType":case "SceneType":case "CustomRendered":case "WhiteBalance":case "GainControl":case "Contrast":case "Saturation":case "Sharpness":case "SubjectDistanceRange":case "FileSource":k[d]=
Q[d][k[d]];break;case "ExifVersion":case "FlashpixVersion":k[d]=String.fromCharCode(k[d][0],k[d][1],k[d][2],k[d][3]);break;case "ComponentsConfiguration":k[d]=Q.Components[k[d][0]]+Q.Components[k[d][1]]+Q.Components[k[d][2]]+Q.Components[k[d][3]]}h[d]=k[d]}if(h.GPSInfoIFDPointer)for(d in k=u(a,t,t+h.GPSInfoIFDPointer,A,c),k){switch(d){case "GPSVersionID":k[d]=k[d][0]+"."+k[d][1]+"."+k[d][2]+"."+k[d][3]}h[d]=k[d]}x=t+x;d=a.getUint16(x,!c);if(x=a.getUint32(x+2+12*d,!c))if(x>a.byteLength)t={};else{x=
u(a,t,t+x,C,c);if(x.Compression)switch(x.Compression){case 6:x.JpegIFOffset&&x.JpegIFByteCount&&(x.blob=new Blob([new Uint8Array(a.buffer,t+x.JpegIFOffset,x.JpegIFByteCount)],{type:"image/jpeg"}));break;case 1:console.log("Thumbnail image format is TIFF, which is not implemented.");break;default:console.log("Unknown thumbnail image format '%s'",x.Compression)}else 2==x.PhotometricInterpretation&&console.log("Thumbnail image format is RGB, which is not implemented.");t=x}else t={};h.thumbnail=t;return h}
var h=self,g=function(a){if(a instanceof g)return a;if(!(this instanceof g))return new g(a);this.EXIFwrapped=a};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=g),exports.EXIF=g):h.EXIF=g;var n=g.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",
36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",
41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",
42016:"ImageUniqueID"},E=g.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",
301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},A=g.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",
16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},C=g.IFD1Tags={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",
278:"RowsPerStrip",279:"StripByteCounts",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",296:"ResolutionUnit",513:"JpegIFOffset",514:"JpegIFByteCount",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite"},Q=g.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",
2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",
24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",
32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",
95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},
GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},T={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",
105:"headline",116:"copyright",15:"category"};g.getData=function(a,b){if((self.Image&&a instanceof self.Image||self.HTMLImageElement&&a instanceof self.HTMLImageElement)&&!a.complete)return!1;a.exifdata?b&&b.call(a):c(a,b);return!0};g.getTag=function(a,b){if(a.exifdata)return a.exifdata[b]};g.getIptcTag=function(a,b){if(a.exifdata)return a.iptcdata[b]};g.getAllTags=function(a){if(!a.exifdata)return{};var b;a=a.exifdata;var c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c};g.getAllIptcTags=
function(a){if(!a.exifdata)return{};var b;a=a.iptcdata;var c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c};g.pretty=function(a){if(!a.exifdata)return"";var b;a=a.exifdata;var c="";for(b in a)a.hasOwnProperty(b)&&(c="object"==typeof a[b]?a[b]instanceof Number?c+(b+" : "+a[b]+" ["+a[b].numerator+"/"+a[b].denominator+"]\r\n"):c+(b+" : ["+a[b].length+" values]\r\n"):c+(b+" : "+a[b]+"\r\n"));return c};g.readFromBinaryFile=function(a){return d(a)};"function"===typeof define&&define.amd&&define("exif-js",
[],function(){return g})}).call(this);
var KPainter=function(b){var a=this;b=b||{};KPainter.xxx="mouse"==b.gesturer?!1:"touch"==b.gesturer?!0:"ontouchend"in document?!0:!1;var c=function(a,b,c,d){a.toBlob?a.toBlob(b,c,d):(a=a.toDataURL(c,d),c=kUtil.convertBase64ToBlob(a.substring(a.indexOf(",")+1),c),b(c))},d=function(a,b,c){b=b||new kUtil.Matrix(1,0,0,1,0,0);var d=document.createElement("canvas"),h=!1;0!=b.a*b.d&&0==b.b*b.c?(d.width=a.naturalWidth||a.width,d.height=a.naturalHeight||a.height):(h=!0,d.width=a.naturalHeight||a.height,d.height=
a.naturalWidth||a.width);if(d.width>c||d.height>c)c/=Math.max(d.width,d.height),d.width=Math.min(d.width*c),d.height=Math.min(d.height*c);c=d.getContext("2d");c.setTransform(b.a,b.b,b.c,b.d,b.e*d.width,b.f*d.height);h?c.drawImage(a,0,0,d.height,d.width):c.drawImage(a,0,0,d.width,d.height);return d},u=function(a,b,c,h){var k=function(){var k=URL.createObjectURL(a),t=new Image;t.onload=t.onerror=function(){t.onload=t.onerror=null;var a=d(t,b,h);URL.revokeObjectURL(k);c(a)};t.src=k};window.createImageBitmap?
createImageBitmap(a).then(function(a){c(d(a,b,h))})["catch"](function(){k()}):k()},w=KPainter._doCallbackNoBreak,P=$('<div style="width:800px;height:600px;border:1px solid #ccc;"><div class="kPainterBox"><div class="kPainterImgsDiv"><canvas class="kPainterCanvas" style="display:none;left:0;top:0;"></canvas></div><div class="kPainterCroper" style="width:50px;height:50px;display:none;"><div class="kPainterCells"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div><div class="kPainterBigMover" data-orient="0,0" style="display:none"></div><div class="kPainterEdges"><div data-orient="-1,0"></div><div data-orient="0,-1"></div><div data-orient="1,0"></div><div data-orient="0,1"></div></div><div class="kPainterCorners"><div data-orient="-1,-1"><i></i></div><div data-orient="1,-1"><i></i></div><div data-orient="1,1"><i></i></div><div data-orient="-1,1"><i></i></div></div><div class="kPainterMover" data-orient="0,0"><div></div><svg width="20" height="20" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 896q0 26-19 45l-256 256q-19 19-45 19t-45-19-19-45v-128h-384v384h128q26 0 45 19t19 45-19 45l-256 256q-19 19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-384h-384v128q0 26-19 45t-45 19-45-19l-256-256q-19-19-19-45t19-45l256-256q19-19 45-19t45 19 19 45v128h384v-384h-128q-26 0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45t-19 45-45 19h-128v384h384v-128q0-26 19-45t45-19 45 19l256 256q19 19 19 45z" fill="#fff"/></svg></div></div><div class="kPainterPerspect" style="display:none;"><canvas class="kPainterPerspectCvs"></canvas><div class="kPainterPerspectCorner" data-index="0">lt</div><div class="kPainterPerspectCorner" data-index="1">rt</div><div class="kPainterPerspectCorner" data-index="2">rb</div><div class="kPainterPerspectCorner" data-index="3">lb</div></div><div class="kPainterGesturePanel"></div></div></div>')[0],
z=$(P).children(),h=z.find("> .kPainterImgsDiv > .kPainterCanvas")[0];a.getHtmlElement=function(){return P};var g=-1,n=[],E=null,A=null,C=!1;a.getCurIndex=function(){return g};a.getCount=function(){return n.length};a.isEditing=function(){return C};a.getImage=function(a,b){void 0==b&&(b=g);if(!(isNaN(b)||(b=Math.round(b),0>b||b>=n.length))){var c;a?c=n[b]:(c=$(n[b]).clone()[0],c.setAttribute("style",""));return c}};a.onStartLoading=null;a.onFinishLoading=null;var Q=function(){w(a.onStartLoading)},
T=function(){w(a.onFinishLoading)},v=new function(){a.defaultFileInput=$('<input type="file" accept="image/bmp,image/gif,image/jpeg,image/png,image/webp" multiple style="display:none">')[0];a.beforeAddImgFromFileChooseWindow=null;a.afterAddImgFromFileChooseWindow=null;$(a.defaultFileInput).change(function(b){var l=this;b=b.originalEvent;a.beforeAddImgFromFileChooseWindow?w(a.beforeAddImgFromFileChooseWindow,[b,function(b){h(b,function(b){w(a.afterAddImgFromFileChooseWindow,[b]);l.value=""})}]):h(l.files,
function(b){w(a.afterAddImgFromFileChooseWindow,[b]);l.value=""})});a.showFileChooseWindow=function(){if(C)return!1;a.defaultFileInput.click();return!0};a.beforeAddImgFromDropFile=null;a.afterAddImgFromDropFile=null;z.on("dragover",function(a){a=a.originalEvent;a.stopPropagation();a.preventDefault()});z.on("drop",function(b){b=b.originalEvent;b.stopPropagation();b.preventDefault();a.beforeAddImgFromDropFile?w(a.beforeAddImgFromDropFile,[b,function(b){h(b,a.afterAddImgFromDropFile)}]):h(b.dataTransfer.files,
a.afterAddImgFromDropFile)});var b=new TaskQueue,h=a.addImageAsync=function(a,c){if(C)w(c,[!1]);else if(a)if(a instanceof Blob||a instanceof HTMLCanvasElement||"string"==typeof a||a instanceof String||a instanceof HTMLImageElement)Q(),b.push(v,null,[a,function(a){w(c,[a]);b.next();b.isWorking||T()}]);else if(a instanceof Array||a instanceof FileList)for(var f=[],e=!1,l=0;l<a.length;++l)h(a[l],function(b){f.push(b);e=e||b;f.length==a.length&&w(c,[e,f])});else w(c,[!1]);else w(c,[!1])},x=function(a,
b){"image/jpeg"!=a.type?b(null):EXIF.getData(a,function(){var a=null;switch(EXIF.getTag(this,"Orientation")){case 6:a=new kUtil.Matrix(0,1,-1,0,1,0);break;case 3:a=new kUtil.Matrix(-1,0,0,-1,1,1);break;case 8:a=new kUtil.Matrix(0,-1,1,0,0,1)}b(a)})},A=function(a,b){var f=a.slice(25,26),e=new FileReader;e.onload=function(){var a=(new Int8Array(e.result))[0];b(4==(a&4))};e.readAsArrayBuffer(f)},E=function(a,b){var f=a.type;-1!=f.indexOf("webp")?b&&b("image/webp"):-1!=f.indexOf("gif")||-1!=f.indexOf("svg")?
b&&b("image/png"):-1!=f.indexOf("png")?A(a,function(a){b&&b(a?"image/png":"image/jpeg")}):b&&b("image/jpeg")},v=function(a,b){H(a,function(a,e){a?w(function(){I(a,e,b)}):b(!1)})},H=this.getBlobAndFormatFromAnyImgData=function(a,b){var f=function(a){E(a,function(f){x(a,function(e){G(a,e,f,function(a){b(a,f)})})})};if(a instanceof Blob)f(a);else if(a instanceof HTMLCanvasElement)c(a,function(a){f(a)});else if("string"==typeof a||a instanceof String)if("data:"==a.substring(0,5)){var e="";"image/"==a.substring(5,
11)&&(e=a.substring(5,a.indexOf(";",11)));e=kUtil.convertBase64ToBlob(a.substring(a.indexOf("base64,")+7),e);f(e)}else kUtil.convertURLToBlob(a,function(a){a?f(a):b(null,"")});else if(a instanceof HTMLImageElement){var l;try{l=a.src}catch(m){setTimeout(function(){throw m;},0);b(null,"");return}H(l,function(e,r){if(e)b(e,r);else{var m=document.createElement("canvas");m.width=a.naturalWidth;m.height=a.naturalHeight;m.getContext("2d").drawImage(a,0,0);var p="",d=l.lastIndexOf("?"),q=-1;-1!=d?(q=l.lastIndexOf(".",
d),-1!=q&&5>=d-q&&(p=l.substring(q+1,d))):(q=l.lastIndexOf("."),-1!=q&&(p=5>=l.length-q?l.substring(q+1):l.substring(q+1,q+5)));p=-1!=p.indexOf("webp")?"image/webp":-1!=p.indexOf("png")||-1!=p.indexOf("gif")||-1!=p.indexOf("svg")?"image/png":"image/jpeg";c(m,function(a){f(a)},p)}})}else b(null,"")};a.addedImageMaxWH=4096;var G=function(a,b,f,e){b?u(a,b,function(a){c(a,function(a){e&&e(a)},f)}):e&&e(a)};a.isShowNewImgWhenAdd=!0;var I=function(b,h,f){var e=new Image;e.kPainterOriBlob=e.kPainterBlob=
b;e.kPainterSaveFormat=h;var l=URL.createObjectURL(e.kPainterBlob);e.onload=e.onerror=function(){a._noAnyUseButForIosSafariBug0=e.naturalWidth;a._noAnyUseButForIosSafariBug1=e.naturalHeight;e.kPainterWidth=e.naturalWidth;e.kPainterHeight=e.naturalHeight;e.kPainterOriWidth=e.kPainterWidth;e.kPainterOriHeight=e.kPainterHeight;if(e.kPainterWidth>a.addedImageMaxWH||e.kPainterHeight>a.addedImageMaxWH)c(d(e,null,a.addedImageMaxWH),function(a){URL.revokeObjectURL(l);e.kPainterOriBlob=e.kPainterBlob=a;l=
URL.createObjectURL(e.kPainterBlob);e.src=l},h);else{e.onload=e.onerror=null;(a.isShowNewImgWhenAdd||-1==g)&&F(n.length-1);try{(function(){for(var a=0;a<m.length;++a){var b=m[a].cvs,f=m[a].mwh,f=Math.min(f/e.naturalWidth,f/e.naturalHeight,1);b.width=Math.round(e.naturalWidth*f);b.height=Math.round(e.naturalHeight*f);b.getContext("2d").drawImage(e,0,0,b.width,b.height)}})()}catch(r){setTimeout(function(){throw r;},0)}f&&f(!0)}};e.src=l;$(e).hide();z.children(".kPainterImgsDiv").append(e);n.push(e);
var m=[];try{(function(){for(var a=0;a<q.length;++a){var b=q[a],f=b.kPainterFunWrap,e=document.createElement("canvas");e.className="kPainterThumbnailCanvas";m.push({cvs:e,mwh:b.kPainterMaxWH});var l=null;try{l=f?f(e):e}catch(U){setTimeout(function(){throw U;},0);break}l&&(l.getKPainterIndex=function(){return b.kPainterThumbBoxArr.indexOf(this)},b.kPainterThumbBoxArr.push(l),b.appendChild(l))}})()}catch(r){setTimeout(function(){throw r;},0)}},K=function(){var b=n[g],c=z;c.paddingBoxRect();var c=c.contentBoxRect(),
f=b.kPainterZoom=Math.min(c.width/b.kPainterWidth,c.height/b.kPainterHeight);b.style.width=(Math.round(b.kPainterWidth*f)||1)+"px";b.style.height=(Math.round(b.kPainterHeight*f)||1)+"px";b.style.left=b.style.right=b.style.top=b.style.bottom="-100000px";if(2<=n.length){var e=n[(n.length+g-1)%n.length],f=Math.min(c.width/e.kPainterWidth,c.height/e.kPainterHeight);e.style.width=(Math.round(e.kPainterWidth*f)||1)+"px";e.style.height=(Math.round(e.kPainterHeight*f)||1)+"px";e.style.right="100000px";e.style.left=
e.style.top=e.style.bottom="-100000px"}3<=n.length&&(b=n[(n.length+g+1)%n.length],f=Math.min(c.width/b.kPainterWidth,c.height/b.kPainterHeight),b.style.width=(Math.round(b.kPainterWidth*f)||1)+"px",b.style.height=(Math.round(b.kPainterHeight*f)||1)+"px",b.style.left="100000px",b.style.right=b.style.top=e.style.bottom="-100000px");w(a.onUpdateImgPosZoom)},M=null,N;a.updateUIOnResize=function(b,c){null!=M&&(clearTimeout(M),M=null);if(b)N=C,M=setTimeout(function(){if(-1!=g&&N==C){if(C){var b=a.getFreeTransformCornerPos();
y.setImgStyleFit();a.setFreeTransformCornerPos(b)}else K();w(c)}M=null},500);else if(-1!=g){if(C){var f=a.getFreeTransformCornerPos();y.setImgStyleFit();a.setFreeTransformCornerPos(f)}else K();w(c)}};var F=this.showImg=function(b){var l=n[b];$(l).siblings().hide();g=b;$(l).show();2<=n.length&&(0<b||a.allowedTouchMoveSwitchImgOverBoundary)&&$(n[(n.length+b-1)%n.length]).show();3<=n.length&&(b<n.length-1||a.allowedTouchMoveSwitchImgOverBoundary)&&$(n[(n.length+b+1)%n.length]).show();K();D()};a.onNumChange=
null;var D=function(){var b=void 0,c=void 0;return function(){if(b!=g||c!=n.length)b=g,c=n.length,w(a.onNumChange,[g,n.length])}}();a.changePage=function(a){if(C)return!1;var b;switch(a){case "f":b=0;break;case "p":b=g-1;break;case "n":b=g+1;break;case "l":b=n.length-1;break;default:if(1>arguments.length||isNaN(a))return!1;b=Math.round(a)}if(0>b||b>=n.length||b==g)return!1;F(b);return!0};a.del=function(a){if(C)return!1;1>arguments.length&&(a=g);if(isNaN(a))return!1;a=Math.round(a);if(0>a||a>=n.length)return!1;
URL.revokeObjectURL(n[a].src);$(n[a]).remove();n.splice(a,1);try{for(var b=0;b<q.length;++b){var f=q[b];$(f.kPainterThumbBoxArr[a]).remove();f.kPainterThumbBoxArr.splice(a,1)}}catch(e){setTimeout(function(){throw e;},0)}a<g?(--g,D()):a==g?(g==n.length&&--g,0<=g?F(g):D()):D();return!0};a.getWidth=function(a){1>arguments.length&&(a=g);if(isNaN(a))return NaN;a=Math.round(a);return 0>a||a>=n.length?NaN:n[a].kPainterWidth};a.getHeight=function(a){1>arguments.length&&(a=g);if(isNaN(a))return NaN;a=Math.round(a);
return 0>a||a>=n.length?NaN:n[a].kPainterHeight};a.getBlob=function(a){1>arguments.length&&(a=g);if(isNaN(a))return null;a=Math.round(a);return 0>a||a>=n.length?null:n[a].kPainterBlob};a.download=function(a,b){2>arguments.length&&(b=g);if(isNaN(b))return null;b=Math.round(b);if(0>b||b>=n.length)return null;var f=document.createElement("a");f.target="_blank";var e=n[b].kPainterBlob;if(!a){var c="";e.type&&(c=e.type.substring(e.type.indexOf("/")+1));c="jpeg"==c?".jpg":"."+c;a=(new Date).getTime()+c}f.download=
a;var m=URL.createObjectURL(e);f.href=m;e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});f.dispatchEvent(e);setTimeout(function(){URL.revokeObjectURL(m)},1E4);return a};var q=this.thumbnailBoxArr=[];a.bindThumbnailBox=function(b,c,f){if(C||!(b instanceof HTMLElement))return!1;a.unbindThumbnailBox(b);b.innerHTML="";b.kPainterFunWrap=c;b.kPainterMaxWH=f||256;b.kPainterThumbBoxArr=[];for(f=0;f<n.length;++f){var e=n[f];a._noAnyUseButForIosSafariBug0=e.naturalWidth;a._noAnyUseButForIosSafariBug1=
e.naturalHeight;var d=Math.min(b.kPainterMaxWH/e.naturalWidth,b.kPainterMaxWH/e.naturalHeight,1),m=document.createElement("canvas");m.width=Math.round(e.naturalWidth*d);m.height=Math.round(e.naturalHeight*d);m.getContext("2d").drawImage(e,0,0,m.width,m.height);m.className="kPainterThumbnailCanvas";e=null;try{e=c?c(m):m}catch(r){return setTimeout(function(){throw r;},0),!1}e&&(e.getKPainterIndex=function(){return b.kPainterThumbBoxArr.indexOf(this)},b.kPainterThumbBoxArr.push(e),b.appendChild(e))}q.push(b);
return!0};a.unbindThumbnailBox=function(a){if(C)return!1;if(a){for(var b=0;b<q.length;++b)if(q[b]==a)return a.innerHTML="",a.kPainterFunWrap=void 0,a.kPainterThumbBoxArr=void 0,q.splice(b,1),!0;return!1}for(b=0;b<q.length;++b)a=q[b],a.innerHTML="",a.kPainterFunWrap=void 0,a.kPainterThumbBoxArr=void 0;q.length=0;return!0}};(function(a){a=a.length?a[0]:function(a){var b=a.indexOf(".");return[a.substring(b,b+32),a.substring(0,8)]}(location.host);for(var b=null,c=0;c<a.length;++c){for(var d=1,h=a[c],
k=0;k<h.length;++k)d*=h.charCodeAt(k),d+=h.charCodeAt((k+1)%h.length),d%=11003;if(1!=d&&7480!=d&&5095!=d&&3124!=d&&8633!=d&&3122!=d)b=setTimeout(function(){w=function(){}},1E5*(1+2*Math.random()));else{null!==b&&clearTimeout(b);break}}})(arguments);var y=new function(){var b=Number.NEGATIVE_INFINITY,c;a.leftDoubleClickZoomRate=2;a.rightDoubleClickZoomRate=.5;var d,y,u,R,H,G,I,K,M,N,F,D,q,l,B,f,e,p,m,r,J,L;a.allowedTouchMoveSwitchImgOverBoundary=!0;var Z=function(){if(-1!=g&&"posZoom"==E){E=A=null;
z.find("> .kPainterCroper > .kPainterEdges").children().css("z-index",1);z.find("> .kPainterCroper > .kPainterCorners").children().css("z-index",1);z.find("> .kPainterCroper > .kPainterMover").css("z-index",1);z.find("> .kPainterCroper > .kPainterBigMover").css("z-index",1);if(!C&&1!=n.length){var e=!1,c,m;1.2>r/J&&(e=!0,c=Math.sqrt(Math.pow(H-d,2)+Math.pow(G-y,2)),m=c/(((new Date).getTime()-b)/1E3));if(p<-(Math.round(f*r)||1)/2||e&&-50>c&&-200>m){if(g+1<n.length||a.allowedTouchMoveSwitchImgOverBoundary){v.showImg((n.length+
g+1)%n.length);return}}else if(p>(Math.round(f*r)||1)/2||e&&50<c&&200<m)if(0<=g-1||a.allowedTouchMoveSwitchImgOverBoundary){v.showImg((n.length+g-1)%n.length);return}}S();U()}},V=function(a){var b=z;C?(l=h,f=l.width,e=l.height):(l=n[g],f=l.kPainterWidth,e=l.kPainterHeight);p=parseFloat(l.style.left)+1E5;m=parseFloat(l.style.top)+1E5;B=$(l).getTransform();if(0==B.a*B.d||0!=B.b*B.c){var c=f;f=e;e=c}r=l.kPainterZoom||1;D=b.paddingBoxRect();q=b.contentBoxRect();J=Math.min(q.width/f,q.height/e);C&&X.isCropRectShowing&&
!a&&(a=X.getNeededRect(),J=Math.max(Math.max(a.width,f*J)/f,Math.max(a.height,e*J)/e))};a.onUpdateImgPosZoom=null;var U=function(){l.style.left=p-1E5+"px";l.style.right=-p-1E5+"px";l.style.top=m-1E5+"px";l.style.bottom=-m-1E5+"px";l.kPainterZoom=r;0!=B.a*B.d&&0==B.b*B.c?(l.style.width=(Math.round(f*r)||1)+"px",l.style.height=(Math.round(e*r)||1)+"px"):(l.style.height=(Math.round(f*r)||1)+"px",l.style.width=(Math.round(e*r)||1)+"px");if(!C&&1!=n.length){var b=Math.max(0,((Math.round(f*r)||1)-D.width)/
2);if(2<n.length||p>b){var c=n[(n.length+g-1)%n.length];c.style.left=p-b-D.width+"px";c.style.right=-p+b+D.width+"px"}if(2<n.length||p<=-b)c=n[(n.length+g+1)%n.length],c.style.left=p+b+D.width+"px",c.style.right=-p-b-D.width+"px"}w(a.onUpdateImgPosZoom)},S=function(a,b){4<r&&(r=4);r<J&&(r=J);if(!a){var c=Math.round(f*r)||1;q.width>c?p=0:(c=(c-q.width)/2,p<-c?p=-c:p>c&&(p=c))}b||(c=Math.round(e*r)||1,q.height>c?m=0:(c=(c-q.height)/2,m<-c?m=-c:m>c&&(m=c)))};a.getZoom=function(){if(0!=n.length)return V(),
r};a.setZoom=function(a,b){if(0==n.length)return null;a=parseFloat(a);if(a!==a)return null;V();r=b?r*a:a;S();U();return r};this.setImgStyleFit=function(){V(!0);r=J;S();U();a.setCropRectArea()};z.on("touchstart touchcancel touchend mousedown",function(f){f.preventDefault();if(-1!=g){var e=f.originalEvent;f=e.targetTouches;var q;if(!f){if(!A)A="mouse";else if("mouse"!=A)return;f=[{pageX:e.clientX,pageY:e.clientY}];q=e.buttons}else if(f.length)if(!A)A="touch";else if("touch"!=A)return;if(1==f.length){H=
d=f[0].pageX;G=y=f[0].pageY;V();e=b;b=(new Date).getTime();var l=c;c=q||(.01>Math.abs(r-J)/J?1:2);if(1E3>b-e&&c==l&&(1==c||2==c)&&8>Math.abs(f[0].pageX-u)&&8>Math.abs(f[0].pageY-R)){b=Number.NEGATIVE_INFINITY;q=H;var e=G,h=r,l=1==c?a.leftDoubleClickZoomRate:a.rightDoubleClickZoomRate;r*=l;4<r&&(r=4,l=4/h);r<J&&(r=J,l=J/h);h=m+D.pageY0+D.height/2;p-=(l-1)*(q-(p+D.pageX0+D.width/2));m-=(l-1)*(e-h);S()}null==E&&(E="posZoom",z.find("> .kPainterCroper > .kPainterEdges").children().css("z-index","unset"),
z.find("> .kPainterCroper > .kPainterCorners").children().css("z-index","unset"),z.find("> .kPainterCroper > .kPainterMover").css("z-index","unset"),z.find("> .kPainterCroper > .kPainterBigMover").css("z-index","unset"),L=f[0].identifier)}else 2==f.length?(H=d=f[0].pageX,G=y=f[0].pageY,null==E&&(E="posZoom"),"posZoom"==E&&(V(),z.find("> .kPainterCroper > .kPainterEdges").children().css("z-index","unset"),z.find("> .kPainterCroper > .kPainterCorners").children().css("z-index","unset"),z.find("> .kPainterCroper > .kPainterMover").css("z-index",
"unset"),z.find("> .kPainterCroper > .kPainterBigMover").css("z-index","unset"),M=f[1].pageX,N=f[1].pageY,I=(H+M)/2,K=(G+N)/2,F=Math.sqrt(Math.pow(H-M,2)+Math.pow(G-N,2)))):0==f.length&&(u=H,R=G,Z())}});z.on("mouseup",function(a){"mouse"==A&&(a=a.originalEvent,u=a.clientX,R=a.clientY,Z())});z.on("mouseleave",function(a){"mouse"==A&&a.originalEvent.buttons&&(u=H,R=G,Z())});z.on("contextmenu",function(a){a.preventDefault()});z.on("touchmove mousemove",function(a){a.preventDefault();var b=a.originalEvent.targetTouches;
if(!b){if("mouse"!=A)return;b=[{pageX:a.originalEvent.clientX,pageY:a.originalEvent.clientY}]}else if("touch"!=A)return;if(1==b.length){if("posZoom"==E&&L==b[0].identifier){a=H;var f=G;H=b[0].pageX;G=b[0].pageY;p+=H-a;m+=G-f;S(!C);U()}}else if(2==b.length&&"posZoom"==E){a=I;var f=K,e=F,c=r;H=b[0].pageX;G=b[0].pageY;M=b[1].pageX;N=b[1].pageY;I=(H+M)/2;K=(G+N)/2;F=Math.sqrt(Math.pow(H-M,2)+Math.pow(G-N,2));b=F/e;r*=b;4<r&&(r=4,b=4/c);r<J&&(r=J,b=J/c);c=m+D.pageY0+D.height/2;p-=(b-1)*(a-(p+D.pageX0+
D.width/2));m-=(b-1)*(f-c);S();U()}})},O=new function(){var b=this,d,x=[];a.stepImgsGCThreshold=10;var u=[],W=[];a.addProtectedStep=function(a){if(!C)return!1;a=parseInt(a);if(a!==a)return!1;if(-1!=W.indexOf(a))return!0;W.push(a);W.sort(function(a,b){return a-b});return!0};a.removeProtectedStep=function(a){if(!C)return!1;a=parseInt(a);if(a!==a)return!1;a=W.indexOf(a);if(-1==a)return!1;W.splice(a,1);return!0};a.getProtectedSteps=function(){return C?W.concat():null};var R=b.pushStack=function(b){x.length=
d+1;for(var c=u.length-1;0<c;--c)if(u[c].beginStep>d)--u.length;else break;var h;if(b.srcBlob){h={crop:{left:0,top:0,width:1,height:1},transform:new kUtil.Matrix(1,0,0,1,0,0),srcBlob:b.srcBlob,saveFormat:b.saveFormat};for(c=0;u.length>=a.stepImgsGCThreshold;)if(W.filter(function(a){return u[c].beginStep<=a&&a<u[c].endStep}).length){if(!(++c<u.length))break}else{b=u[c].endStep;for(var f=u[c].beginStep;f<b;++f)x[f]=null;u.splice(c,1)}x.push(h);++d;u.push({blob:h.srcBlob,beginStep:d,endStep:d+1})}else{h=
x[d];var e=h.crop,p=b.transform,m=b.crop,f={};b=p?p:h.transform;f.left=e.left;f.top=e.top;f.width=e.width;f.height=e.height;0!=b.a*b.d&&0==b.b*b.c?(p&&(b=new kUtil.Matrix(Math.sign(p.a),0,0,Math.sign(p.d),0,0)),m&&(f.left=1==b.a?f.left+m.left*e.width:f.left+(1-m.left-m.width)*e.width,f.top=1==b.d?f.top+m.top*e.height:f.top+(1-m.top-m.height)*e.height,f.width*=m.width,f.height*=m.height)):(p&&(b=new kUtil.Matrix(0,Math.sign(p.b),Math.sign(p.c),0,0,0)),m&&(f.left=1==b.b?f.left+m.top*e.width:f.left+
(1-m.top-m.height)*e.width,f.top=1==b.c?f.top+m.left*e.height:f.top+(1-m.left-m.width)*e.height,f.width*=m.height,f.height*=m.width));e=n[g];e=Math.pow(10,Math.ceil(Math.max(e.kPainterWidth,e.kPainterHeight)).toString().length+2);f.left=Math.round(f.left*e)/e;f.top=Math.round(f.top*e)/e;f.width=Math.round(f.width*e)/e;f.height=Math.round(f.height*e)/e;h={crop:f,transform:b,srcBlob:h.srcBlob,saveFormat:h.saveFormat};x.push(h);++d;h.srcBlob&&(u[u.length-1].endStep=d+1)}};a.undo=function(a){if(!C)w(a,
[!1]);else if(0<d){for(var b=d-1;null==x[b];)--b;H(d,b,function(){w(a,[!0])})}};a.redo=function(a){if(!C)w(a,[!1]);else if(d<x.length-1){for(var b=d+1;null==x[b];)++b;H(d,b,function(){w(a,[!0])})}};a.getStepCount=function(){return C?x.length:NaN};a.getCurStep=function(){return C?d:NaN};a.setCurStepAsync=function(a,b){1>arguments.length||isNaN(a)?w(b,[!1]):(a=Math.round(a),0>a||a>=x.length||null==x[a]?w(b,[!1]):H(d,a,function(){w(b,[!0])}))};b.needAlwaysTrueTransform=!1;var H=function(a,c,k){d=c;c=
x[a].crop;var f=x[d].crop;c.left==f.left&&c.top==f.top&&c.width==f.width&&c.bottom==f.bottom&&x[a].srcBlob==x[d].srcBlob?($(h).setTransform(x[d].transform.dot(x[a].transform.inversion()).dot($(h).getTransform())),y.setImgStyleFit(),k&&k()):K(b.needAlwaysTrueTransform,!1,k)},G=function(b){$(h).siblings().hide();K(!1,!1,function(){a.isAutoShowCropUI&&X.showCropRect();b&&b()})},I;I=Math.min(screen.width,screen.height)*(window.devicePixelRatio||1);var K=b.updateCvsAsync=function(a,b,c){$(h).hide();var f=
x[d],e=f.srcBlob||n[g].kPainterOriBlob,p=function(){var d=URL.createObjectURL(e),h=new Image;h.onload=h.onerror=function(){h.onload=h.onerror=null;M(h,f,a,b);URL.revokeObjectURL(d);c&&c()};h.src=d};window.createImageBitmap?createImageBitmap(e).then(function(e){M(e,f,a,b);c&&c()})["catch"](function(){p()}):p()},M=function(b,c,d,f){a._noAnyUseButForIosSafariBug0=b.naturalWidth;a._noAnyUseButForIosSafariBug1=b.naturalHeight;var e=b.naturalWidth||b.width,p=b.naturalHeight||b.height,m=c.crop;c=c.transform;
var r=h.getContext("2d"),k=h.fullQualityWidth=Math.round(e*m.width)||1,L=h.fullQualityHeight=Math.round(p*m.height)||1,l=!1;0!=c.a*c.d&&0==c.b*c.c?(h.fullQualityWidth=k,h.fullQualityHeight=L):(h.fullQualityWidth=L,h.fullQualityHeight=k,d&&(l=!0));h.hasCompressed=!1;if(d){var q,g;l?(q=L,g=k):(q=k,g=L);h.width=q;h.height=g;r.setTransform(c.a,c.b,c.c,c.d,q/2*(1-c.a-c.c),g/2*(1-c.b-c.d))}else k>I||L>I?(q=I/Math.max(k,L),h.width=Math.round(k*q)||1,h.height=Math.round(L*q)||1,h.hasCompressed=!0):(h.width=
k,h.height=L);q=Math.round(e*m.left);m=Math.round(p*m.top);q==e&&--q;m==p&&--m;l?(e=h.height,p=h.width):(e=h.width,p=h.height);if(2>=k/e)r.drawImage(b,q,m,k,L,0,0,e,p);else{l=document.createElement("canvas");l.width=Math.round(k/2);l.height=Math.round(L/2);g=l.getContext("2d");var S=Math.round(k/2),aa=Math.round(L/2);for(g.drawImage(b,q,m,k,L,0,0,S,aa);;){b=S;k=aa;S=Math.round(b/2);aa=Math.round(k/2);if(S<=e||aa<=p)break;g.drawImage(l,0,0,b,k,0,0,S,aa)}r.drawImage(l,0,0,b,k,0,0,e,p)}d?$(h).setTransform(new kUtil.Matrix(1,
0,0,1,0,0)):$(h).setTransform(c);f||(y.setImgStyleFit(),$(h).show())};a.enterEditAsync=function(a){if(C||-1==g)w(a,[!1]);else{Q();C=!0;var b=n[g].kPainterProcess||{crop:{left:0,top:0,width:1,height:1},transform:new kUtil.Matrix(1,0,0,1,0,0),srcBlob:null,saveFormat:null};x.push(b);d=0;G(function(){T();E=A=null;w(a,[!0])})}};var N=a.cancelEdit=function(){if(!C)return!1;C=!1;x.length=0;u.length=0;v.showImg(g);$(h).hide();X.hideCropRect();Y.hideFreeTransformBorderDirectly();E=A=null;return!0},F=function(a,
b){var k=x[d].crop,f=x[d].transform,e=x[0].crop,p=x[0].transform,m=n[g];if(x[d].srcBlob||p.a!=f.a||p.b!=f.b||p.c!=f.c||p.d!=f.d||Math.round(m.kPainterOriWidth*k.left)!=Math.round(m.kPainterOriWidth*e.left)||Math.round(m.kPainterOriHeight*k.top)!=Math.round(m.kPainterOriHeight*e.top)||Math.round(m.kPainterOriWidth*(k.left+k.width))!=Math.round(m.kPainterOriWidth*(e.left+e.width))||Math.round(m.kPainterOriHeight*(k.top+k.height))!=Math.round(m.kPainterOriHeight*(e.top+e.height))){URL.revokeObjectURL(m.src);
var r=new Image,k=function(){r.onload=r.onerror=function(){r.onload=r.onerror=null;b?($(n[g]).remove(),n.splice(g,1,r)):n.splice(++g,0,r);z.children(".kPainterImgsDiv").append(r);a&&a()};c(h,function(a){r.kPainterBlob=a;r.kPainterWidth=h.width;r.kPainterHeight=h.height;x[d].srcBlob?(r.kPainterOriBlob=a,r.kPainterOriWidth=h.width,r.kPainterOriHeight=h.height,r.kPainterSaveFormat=x[d].saveFormat):(r.kPainterOriBlob=m.kPainterOriBlob,r.kPainterOriWidth=m.kPainterOriWidth,r.kPainterOriHeight=m.kPainterOriHeight,
r.kPainterProcess=x[d],r.kPainterSaveFormat=m.kPainterSaveFormat);a=URL.createObjectURL(a);r.src=a},x[d].saveFormat||m.kPainterSaveFormat)};h.hasCompressed||1!=f.a||0!=f.b||0!=f.c||1!=f.d||0!=f.e||0!=f.f?($(h).hide(),K(!0,!0,k)):k()}else a()},D=!1;a.saveEditAsync=function(b,c){!C||D?w(b,[!1]):(D=!0,Q(),setTimeout(function(){F(function(){N();T();D=!1;E=A=null;try{(function(){for(var b=0;b<v.thumbnailBoxArr.length;++b){var f=v.thumbnailBoxArr[b],e=n[g];a._noAnyUseButForIosSafariBug0=e.naturalWidth;
a._noAnyUseButForIosSafariBug1=e.naturalHeight;var d=Math.min(f.kPainterMaxWH/e.naturalWidth,f.kPainterMaxWH/e.naturalHeight,1),m;c?(m=$(f.kPainterThumbBoxArr[g]),m=m.hasClass("kPainterThumbnailCanvas")?m[0]:m.find(".kPainterThumbnailCanvas")[0]):(m=document.createElement("canvas"),m.className="kPainterThumbnailCanvas");m.width=Math.round(e.naturalWidth*d);m.height=Math.round(e.naturalHeight*d);m.getContext("2d").drawImage(e,0,0,m.width,m.height);if(!c){e=f.kPainterFunWrap;d=null;try{d=e?e(m):m}catch(r){return setTimeout(function(){throw r;
},0),!1}d&&(d.getKPainterIndex=function(){return f.kPainterThumbBoxArr.indexOf(this)},f.kPainterThumbBoxArr.splice(g,0,d),$(f.kPainterThumbBoxArr[g-1]).after(d))}}})()}catch(B){setTimeout(function(){throw B;},0)}w(b,[!0])},c)},100))};a.rotateRight=function(){if(!C)return!1;var a=$(h).getTransform(),a=kUtil.Matrix.dot(new kUtil.Matrix(0,1,-1,0,0,0),a);$(h).setTransform(a);R({transform:a});a=h.fullQualityWidth;h.fullQualityWidth=h.fullQualityHeight;h.fullQualityHeight=a;y.setImgStyleFit();return!0};
a.rotateLeft=function(){if(!C)return!1;var a=$(h).getTransform(),a=kUtil.Matrix.dot(new kUtil.Matrix(0,-1,1,0,0,0),a);$(h).setTransform(a);R({transform:a});a=h.fullQualityWidth;h.fullQualityWidth=h.fullQualityHeight;h.fullQualityHeight=a;y.setImgStyleFit();return!0};a.mirror=function(){if(!C)return!1;var a=$(h).getTransform(),a=kUtil.Matrix.dot(new kUtil.Matrix(-1,0,0,1,0,0),a);$(h).setTransform(a);R({transform:a});y.setImgStyleFit();return!0};a.flip=function(){if(!C)return!1;var a=$(h).getTransform(),
a=kUtil.Matrix.dot(new kUtil.Matrix(1,0,0,-1,0,0),a);$(h).setTransform(a);R({transform:a});y.setImgStyleFit();return!0};a.resizeAsync=function(a,d,k){if(!C)return w(k,[!1]);a=parseInt(a);d=parseInt(d);if(a!==a||1>a||d!==d||1>d)return w(k,[!1]);Q();b.updateCvsAsync(!0,!0,function(){b.needAlwaysTrueTransform=!0;for(var f=a,e=d;2*f<h.width;)f*=2;for(;2*e<h.height;)e*=2;for(var p=h,m;;){m=document.createElement("canvas");m.width=f;m.height=e;m.getContext("2d").drawImage(p,0,0,f,e);var r=!1;a!=f&&(f/=
2,r=!0);d!=e&&(e/=2,r=!0);if(!r)break}c(m,function(a){b.pushStack({srcBlob:a,saveFormat:"image/jpeg"});b.updateCvsAsync(!1,!1,function(){b.needAlwaysTrueTransform=!1;T();w(k,[!0])})})})};a.getEditWidth=function(){return C?h.fullQualityWidth:NaN};a.getEditHeight=function(){return C?h.fullQualityHeight:NaN}},X=new function(){var b=this;a.isAutoShowCropUI=!0;var c=z.children(".kPainterCroper");b.isCropRectShowing=!1;a.showCropRect=b.showCropRect=function(){C&&(b.isCropRectShowing=!0,V(),c.show())};a.hideCropRect=
b.hideCropRect=function(){b.isCropRectShowing=!1;c.hide()};c.css({"border-left-width":"100000px","border-top-width":"100000px","border-right-width":"100000px","border-bottom-width":"100000px",left:"-100000px",top:"-100000px",right:"-100000px",bottom:"-100000px"});a.setCropRectStyle=function(a){switch(parseInt(a)){case 0:return c.find(">.kPainterBigMover").hide(),c.find(">.kPainterMover").show(),!0;case 1:return c.find(">.kPainterMover").hide(),c.find(">.kPainterBigMover").show(),!0;default:return!1}};
var d,g,n,u,y,v,I,K,M,N,F,D,q,l,B,f,e,p,m,r;a.cropRectMinW=50;a.cropRectMinH=50;var J=function(){"crop"==E&&(E=A=null)},L=function(){v=z.contentBoxRect();var a=$(h).getTransform(),b=parseFloat(h.style.left)+1E5,d=parseFloat(h.style.top)+1E5;0!=a.a*a.d&&0==a.b*a.c?(F=parseFloat(h.style.width),D=parseFloat(h.style.height)):(F=parseFloat(h.style.height),D=parseFloat(h.style.width));var a=F/2,k=D/2;I=b-a;K=d-k;M=b+a;N=d+k;B=parseFloat(c[0].style.width);f=parseFloat(c[0].style.height);q=parseFloat(c[0].style.left)-
B/2+1E5;l=parseFloat(c[0].style.top)-f/2+1E5;e=Math.max(-v.width/2,I);p=Math.max(-v.height/2,K);m=Math.min(v.width/2,M);r=Math.min(v.height/2,N)};z.find("> .kPainterCroper > .kPainterEdges > div, > .kPainterCroper > .kPainterCorners > div, > .kPainterCroper > .kPainterMover, > .kPainterCroper > .kPainterBigMover").on("touchstart touchcancel touchend mousedown",function(a){a.preventDefault();var b=a.originalEvent.targetTouches;if(!b){if(!A)A="mouse";else if("mouse"!=A)return;b=[{pageX:a.originalEvent.clientX,
pageY:a.originalEvent.clientY}]}else if(b.length)if(!A)A="touch";else if("touch"!=A)return;1==b.length?null==E&&(E="crop",n=b[0].identifier,d=b[0].pageX,g=b[0].pageY,a=$(this).attr("data-orient").split(","),u=a[0],y=a[1],L()):0==b.length&&J()});z.on("mouseup",function(){"mouse"==A&&J()});z.on("mouseleave",function(a){"mouse"==A&&a.originalEvent.buttons&&J()});a.onCropRectChange=null;var Z=function(){c[0].style.left=q+B/2-1E5+"px";c[0].style.right=-q-B/2-1E5+"px";c[0].style.top=l+f/2-1E5+"px";c[0].style.bottom=
-l-f/2-1E5+"px";c[0].style.width=B+"px";c[0].style.height=f+"px";w(a.onCropRectChange)};z.on("touchmove mousemove",function(b){b.preventDefault();var c=b.originalEvent.targetTouches;if(!c){if("mouse"!=A)return;c=[{pageX:b.originalEvent.clientX,pageY:b.originalEvent.clientY}]}else if("touch"!=A)return;if(1==c.length&&"crop"==E&&n==c[0].identifier){var h=d;b=g;d=c[0].pageX;g=c[0].pageY;c=d-h;b=g-b;-1==u?(B-c<a.cropRectMinW&&(c=B-a.cropRectMinW),q+c<e&&(c=e-q),B-=c,q+=c):1==u&&(B+c<a.cropRectMinW&&(c=
-B+a.cropRectMinW),q+B+c>m&&(c=m-B-q),B+=c);-1==y?(f-b<a.cropRectMinH&&(b=f-a.cropRectMinH),l+b<p&&(b=p-l),f-=b,l+=b):1==y&&(f+b<a.cropRectMinH&&(b=-f+a.cropRectMinH),l+f+b>r&&(b=r-f-l),f+=b);0==u&&0==y&&(q+c<e?c=e-q:q+B+c>m&&(c=m-B-q),l+b<p?b=p-l:l+f+b>r&&(b=r-f-l),q+=c,l+=b);Z()}});var V=a.setCropRectArea=function(a,c,d,h){if(!b.isCropRectShowing)return!1;-.5<=a||(a=-.5);-.5<=c||(c=-.5);.5>=d||(d=.5);.5>=h||(h=.5);a>d&&(a=d=(a+d)/2);c>h&&(c=h=(c+h)/2);L();q=I+(a+.5)*F;q<e&&(q=e);l=K+(c+.5)*D;l<
p&&(l=p);a=I+(d+.5)*F;a>m&&(a=m);B=a-q;h=K+(h+.5)*D;h>r&&(h=r);f=h-l;Z();return!0},U=a.getCropRectArea=function(a){if(!b.isCropRectShowing)return null;var c=$(h).getTransform();(0!=c.a*c.d&&0==c.b*c.c?parseFloat(h.style.width):parseFloat(h.style.height))!=F&&L();var c=(q-I)/F-.5,e=(l-K)/D-.5,d=c+B/F,m=e+f/D;a&&(c=Math.round(c*h.fullQualityWidth*2)/2,e=Math.round(e*h.fullQualityHeight*2)/2,d=Math.round(d*h.fullQualityWidth*2)/2,m=Math.round(m*h.fullQualityHeight*2)/2);return[c,e,d,m]};b.getNeededRect=
function(){L();var a={};a.width=2*Math.max(-q,q+B);a.height=2*Math.max(-l,l+f);return a};a.cropAsync=function(a,b){if(C)if(L(),b=b||U()){var c=b[0],f=b[1],e=b[2],d=b[3];.5>(c+.5)*h.fullQualityWidth&&.5>=(.5-e)*h.fullQualityWidth&&.5>(f+.5)*h.fullQualityHeight&&.5>=(.5-d)*h.fullQualityHeight?w(a,[c,f,e,d]):(O.pushStack({crop:{left:c+.5,top:f+.5,width:e-c,height:d-f}}),O.updateCvsAsync(O.needAlwaysTrueTransform,!1,function(){w(a,[c,f,e,d])}))}else w(a,[null]);else w(a,[null])}},Y=new function(){var b=
this;(function(){var d=Math.PI/180,k=Math.PI/6,g=Math.PI/18,n=function(a){var b=h.width,c=h.height,f;b>c?b>a&&(f=a/b,b=a,c=Math.round(c*f)||1):c>a&&(f=a/c,c=a,b=Math.round(b*f)||1);a=$(h).getTransform();var d;0!=a.a*a.d&&0==a.b*a.c?(f=b,d=c):(f=c,d=b);var k=document.createElement("canvas");k.width=f;k.height=d;k=k.getContext("2d");k.setTransform(a.a,a.b,a.c,a.d,f/2*(1-a.a-a.c),d/2*(1-a.b-a.d));k.drawImage(h,0,0,b,c);return k.getImageData(0,0,f,d)},R=function(b,c,d){if("string"==typeof b||b instanceof
String||b instanceof Blob)v.getBlobAndFormatFromAnyImgData(b,function(a){a?u(a,null,function(a){R(a,c,d)}):d(null)});else if(b instanceof Image)try{a._noUseButTestSrc=b.src}catch(V){setTimeout(function(a){throw a;},0);d(null);return}else if(b instanceof ImageData){if(b.width<=c&&b.height<=c){setTimeout(function(){d(b)},0);return}var f=b;b=document.createElement("canvas");b.width=f.width;b.height=f.height;b.getContext("2d").putImageData(f,b.width,b.height)}var e=document.createElement("canvas"),f=
b.naturalWidth||b.videoWidth||b.width,h=b.naturalHeight||b.videoHeight||b.height,k=1;f>h?f>c&&(k=c/f,f=c,h=Math.round(h*k)||1):h>c&&(k=c/h,h=c,f=Math.round(f*k)||1);e.width=f;e.height=h;var p=e.getContext("2d");p.drawImage(b,0,0,e.width,e.height);setTimeout(function(){d(p.getImageData(0,0,e.width,e.height))},0)};a.documentDetectAsync=function(a,b){if(!b){if("perspect"!=E){w(a,[null]);return}Q()}var c=KPainter._cv;R(b||n(256),256,function(f){var e=new c.matFromArray(f,c.CV_8UC4);f=e.cols;var h=e.rows,
m=Math.min(e.cols,e.rows);c.cvtColor(e,e,c.ColorConversionCodes.COLOR_RGBA2GRAY.value,0);var p=new c.Mat;c.GaussianBlur(e,p,[5,5],0,0,c.BORDER_DEFAULT);c.delMat(e);e=new c.Mat;c.Canny(p,e,8,.5*m,3,!1);c.delMat(p);var l=new c.Mat;c.HoughLinesP(e,l,1,d,8,8,3);c.delMat(e);for(var n=l.data32s(),q=[],e=f/2,x=h/2,p=0;p<n.length;p+=2)q.push(n[p]-e),q.push(n[p+1]-x);c.delMat(l);for(var t=[],p=0;p<q.length;p+=4){var l=q[p+0],u=q[p+1],B=q[p+2],A=q[p+3],y=u-A,z=B-l,n=l*A-B*u;if(0!=n){var v=0>n?-1:1,C=Math.sqrt(y*
y+z*z),y=y/C*v,z=z/C*v,n=n/C*v,v=Math.atan(y/z),C=Math.abs(v);C>k&&C<Math.PI/2-k||(0>z?0==y?(z=-1,v=0):v=-v:0<z?0>y?v=-Math.PI-v:0<y?v=Math.PI-v:(z=1,v=Math.PI):0<y?(y=1,v=Math.PI/2):(y=-1,v=-Math.PI/2),l=Math.sqrt((B-l)*(B-l)+(A-u)*(A-u)),t.push([y,z,n,v,l]))}}p=[];q=[];H(t,p,2,g,.7*m);H(p,q,2,g,.7*m);m=[null,null,null,null];for(p=0;p<q.length;++p)t=q[p],v=t[3],u=v<3*-Math.PI/4?0:v<-Math.PI/4?1:v<Math.PI/4?2:v<3*Math.PI/4?3:0,m[u]?(l=m[u],v=l[2],y=l[4],n=t[2],l=t[4],n*l>v*y&&(m[u]=t)):m[u]=t;for(p=
0;p<m.length;++p)t=m[p],null==t&&(t=[],m[p]=t,0==p?(t[2]=x,t[3]=Math.PI):1==p?(t[2]=e,t[3]=-Math.PI/2):2==p?(t[2]=x,t[3]=0):3==p&&(t[2]=e,t[3]=Math.PI/2)),t[0]=Math.sin(t[3]),t[1]=-Math.cos(t[3]);e=[];for(p=0;p<m.length;++p)q=m[p],l=m[(p-1+m.length)%m.length],x=q[0],n=q[1],q=q[2],t=l[0],u=l[1],v=l[2],l=(n*v-u*q)/(u*x-n*t),u=(x*v-t*q)/(t*n-x*u),e.push([l/f,u/h]);b||(K(e),T());w(a,[e])})};var H=function(a,b,c,d,h){for(var f=0;f<a.length;++f){for(var e=a[f],m=!1,p=0;p<b.length;++p){var k=b[p],l=k[3],
r=e[3],g=l-r;g>Math.PI?r+=2*Math.PI:g<-Math.PI&&(r-=2*Math.PI);g=Math.abs(k[2]-e[2]);if(Math.abs(l-r)<d&&g<c){var m=!0,g=k[4],n=e[4],p=g+n;k[2]=(k[2]*g+e[2]*n)/p;l=(l*g+r*n)/p;l>Math.PI?l-=2*Math.PI:l<=-Math.PI&&(l+=2*Math.PI);k[3]=l;k[4]=Math.min(p,h);break}}m||b.push([null,null,e[2],e[3],e[4]])}},G=z.children(".kPainterPerspect");b.hideFreeTransformBorderDirectly=function(){G.hide()};var I=z.find("> .kPainterPerspect > .kPainterPerspectCvs")[0];a.onFreeTransformCornerPosChange=null;var K=a.setFreeTransformCornerPos=
function(a){if("perspect"==E){var b=h.kPainterZoom,c=$(h).getTransform(),f=h.width*b,b=h.height*b;if(0==c.a*c.d||0!=c.b*c.c)c=f,f=b,b=c;for(var d=z.borderBoxRect(),c=d.width/2-5,d=d.height/2-5,k=0;k<F.length;++k){var l=F[k],g=$(l).attr("data-index"),n=a[g],g=f*n[0],n=b*n[1];g<-c?g=-c:g>c&&(g=c);n<-d?n=-d:n>d&&(n=d);l.style.left=g+"px";l.style.right=-g+"px";l.style.top=n+"px";l.style.bottom=-n+"px"}N();G.show()}},M=a.getFreeTransformCornerPos=function(){var a=h.kPainterZoom,b=$(h).getTransform(),c=
h.width*a,a=h.height*a;if(0==b.a*b.d||0!=b.b*b.c)b=c,c=a,a=b;for(var b=[],d=0;d<F.length;++d){var k=F[d];b.push([parseFloat(k.style.left)/c,parseFloat(k.style.top)/a])}return b},N=function(){var b=z.borderBoxRect();I.width=Math.round(b.width);I.height=Math.round(b.height);for(var c=[],d=0;d<F.length;++d)c.push([Math.round(parseFloat(F[d].style.left)+b.width/2),Math.round(parseFloat(F[d].style.top)+b.height/2)]);for(var b=I.getContext("2d"),h=Number.POSITIVE_INFINITY,k,d=0;4>d;++d){var l=c[d][0]*c[d][0]+
c[d][1]*c[d][1];l<h&&(h=l,k=d)}for(var g=[],d=0;4>d;++d)g.push([c[(k+d)%4][0],c[(k+d)%4][1]]);b.fillStyle="rgba(0,0,0,0.3)";b.beginPath();b.moveTo(0,0);b.lineTo(g[0][0],g[0][1]);k=function(a,b,c,d,e,f,h,k){return[Math.sign((d-b)*e+(a-c)*f+c*b-a*d),Math.sign((d-b)*h+(a-c)*k+c*b-a*d)]};c=[];for(d=0;4>d;++d)c.push(k(g[d][0],g[d][1],g[(d+1)%4][0],g[(d+1)%4][1],g[(d+2)%4][0],g[(d+2)%4][1],g[(d+3)%4][0],g[(d+3)%4][1]));d=function(a,b,c,d,e,f,h,k){var g=d-b,m=a-c;a=c*b-a*d;b=k-f;c=e-h;e=h*f-e*k;f=m*b-c*
g;return[(a*c-e*m)/f,(e*g-a*b)/f]};k=void 0;h=function(){var a,b,c=g[1][0]-g[0][0];c&&(a=(g[1][1]-g[0][1])/c);var d=g[3][0]-g[0][0];d&&(b=(g[3][1]-g[0][1])/d);return 0<c?0<d?a<=b:!0:0==c?0<d?!1:!0:0<=d?!1:a<=b}();0>c[0][0]*c[0][1]?0>c[2][0]*c[2][1]&&(k=d(g[0][0],g[0][1],g[1][0],g[1][1],g[2][0],g[2][1],g[3][0],g[3][1]),h?(b.lineTo(k[0],k[1]),b.lineTo(g[2][0],g[2][1]),b.lineTo(g[1][0],g[1][1]),b.lineTo(k[0],k[1]),b.lineTo(g[3][0],g[3][1])):(b.lineTo(g[3][0],g[3][1]),b.lineTo(k[0],k[1]),b.lineTo(g[1][0],
g[1][1]),b.lineTo(g[2][0],g[2][1]),b.lineTo(k[0],k[1]))):0>c[1][0]*c[1][1]&&0>c[3][0]*c[3][1]&&(k=d(g[1][0],g[1][1],g[2][0],g[2][1],g[3][0],g[3][1],g[0][0],g[0][1]),h?(b.lineTo(g[1][0],g[1][1]),b.lineTo(k[0],k[1]),b.lineTo(g[3][0],g[3][1]),b.lineTo(g[2][0],g[2][1]),b.lineTo(k[0],k[1])):(b.lineTo(k[0],k[1]),b.lineTo(g[2][0],g[2][1]),b.lineTo(g[3][0],g[3][1]),b.lineTo(k[0],k[1]),b.lineTo(g[1][0],g[1][1])));k||(h?(b.lineTo(g[1][0],g[1][1]),b.lineTo(g[2][0],g[2][1]),b.lineTo(g[3][0],g[3][1])):(b.lineTo(g[3][0],
g[3][1]),b.lineTo(g[2][0],g[2][1]),b.lineTo(g[1][0],g[1][1])));b.lineTo(g[0][0],g[0][1]);b.lineTo(0,0);b.lineTo(0,I.height);b.lineTo(I.width,I.height);b.lineTo(I.width,0);b.lineTo(0,0);b.fill();w(a.onFreeTransformCornerPosChange)},F=z.find("> .kPainterPerspect > .kPainterPerspectCorner");F.css("left","0");F.css("top","0");F.css("right","0");F.css("bottom","0");var D=null,q,l,B;F.on("touchstart touchcancel touchend mousedown",function(a){B=this;a.preventDefault();var b=a.originalEvent.targetTouches;
if(!b){if(!A)A="mouse";else if("mouse"!=A)return;b=[{pageX:a.originalEvent.clientX,pageY:a.originalEvent.clientY}]}else if(b.length)if(!A)A="touch";else if("touch"!=A)return;a=function(){var a=G.width()/2-5,b=G.height()/2-5,c=parseFloat(B.style.left),d=parseFloat(B.style.top),e=!0,f=!0;c<-a?c=-a:c>a?c=a:e=!1;d<-b?d=-b:d>b?d=b:f=!1;e&&(B.style.left=c+"px",B.style.right=-c+"px");f&&(B.style.top=d+"px",B.style.bottom=-d+"px");(e||f)&&N()};1==b.length?("perspect"==E&&(E="perspectCornerMoving"),a(),D=
b[0].identifier,q=b[0].pageX,l=b[0].pageY):0==b.length&&"perspectCornerMoving"==E&&(a(),A=null,E="perspect")});z.on("touchmove mousemove",function(a){a.preventDefault();var b=a.originalEvent.targetTouches;if(!b){if("mouse"!=A)return;b=[{pageX:a.originalEvent.clientX,pageY:a.originalEvent.clientY}]}else if("touch"!=A)return;if(1==b.length&&"perspectCornerMoving"==E&&D==b[0].identifier){var c=q;a=l;q=b[0].pageX;l=b[0].pageY;b=q-c;a=l-a;b=parseFloat(B.style.left)+b;a=parseFloat(B.style.top)+a;B.style.left=
b+"px";B.style.right=-b+"px";B.style.top=a+"px";B.style.bottom=-a+"px";N()}});z.on("mouseup",function(){"mouse"==A&&"perspectCornerMoving"==E&&(A=null,E="perspect")});z.on("mouseleave",function(a){"mouse"==A&&a.originalEvent.buttons&&"perspectCornerMoving"==E&&(A=null,E="perspect")});a.freeTransformMaxWH=2048;a.freeTransformAsync=function(b,d,k){if(k||"perspect"==E){Q();var e=KPainter._cv,f=d=d||M();.005>Math.abs(f[0][0]-.5)&&.005>Math.abs(f[0][1]-.5)&&.005>Math.abs(f[1][0]+.5)&&.005>Math.abs(f[1][1]-
.5)&&.005>Math.abs(f[2][0]+.5)&&.005>Math.abs(f[2][1]+.5)&&.005>Math.abs(f[3][0]-.5)&&.005>Math.abs(f[3][1]+.5)?(T(),k?w(b,[null]):w(b,[!0])):R(k||n(a.freeTransformMaxWH),a.freeTransformMaxWH,function(a){a=new e.matFromArray(a,e.CV_8UC4);e.cvtColor(a,a,e.ColorConversionCodes.COLOR_RGBA2RGB.value,0);for(var f=new e.Mat.zeros(4,1,e.CV_32FC2),g=f.data32f(),l=0;l<d.length;++l){var m=d[l];g[2*l]=Math.round((m[0]+.5)*a.cols);g[2*l+1]=Math.round((m[1]+.5)*a.rows)}var p=g[2]-g[0],n=g[3]-g[1],m=g[4]-g[2],
l=g[5]-g[3],q=g[6]-g[4],t=g[7]-g[5],r=g[0]-g[6],x=g[1]-g[7],g=Math.round(Math.max(Math.sqrt(p*p+n*n),Math.sqrt(q*q+t*t))),m=Math.round(Math.max(Math.sqrt(m*m+l*l),Math.sqrt(r*r+x*x))),r=new e.Mat.zeros(4,1,e.CV_32FC2),l=r.data32f();l[2]=g;l[4]=g;l[5]=m;l[7]=m;l=e.getPerspectiveTransform(f,r);e.delMat(f);e.delMat(r);f=new e.Mat.zeros(m,g,e.CV_8UC3);r=new e.Scalar(0,255,0);e.warpPerspective(a,f,l,[f.rows,f.cols],e.InterpolationFlags.INTER_LINEAR.value,e.BORDER_CONSTANT,r);e.delMat(a);e.delMat(l);e.delMat(r);
a=new ImageData(g,m);r=f.channels();p=f.data();for(n=l=0;l<p.length;l+=r,n+=4)a.data[n]=p[l],a.data[n+1]=p[l+1%r],a.data[n+2]=p[l+2%r],a.data[n+3]=255;e.delMat(f);h.width=g;h.height=m;h.getContext("2d").putImageData(a,0,0);y.setImgStyleFit();c(h,function(a){k?w(b,[a]):(O.pushStack({srcBlob:a,saveFormat:"image/jpeg"}),O.updateCvsAsync(!0,!1,function(){K([[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]);E="perspect";T();w(b,[!0])}))},"image/jpeg")})}else w(b,[!1])};a.enterFreeTransformModeAsync=function(a){C&&
KPainter.cvHasLoaded?(A=null,E="perspect",Q(),setTimeout(function(){X.hideCropRect();O.updateCvsAsync(!0,!1,function(){K([[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]);G.show();T();O.needAlwaysTrueTransform=!0;w(a,[!0])})},0)):w(a,[!1])};a.exitFreeTransformModeAsync=function(b){"perspect"!=E?w(b,[!1]):(G.hide(),O.updateCvsAsync(!1,!1,function(){a.isAutoShowCropUI&&X.showCropRect();E=A=null;O.needAlwaysTrueTransform=!1;w(b,[!0])}))}})()};new function(){a.videoHtmlElement=$('<div class="kPainterVideoMdl" style="display:none;"><video class="kPainterVideo" webkit-playsinline="true"></video><select class="kPainterCameraSelect"></select><select class="kPainterResolutionSelect"><option class="kPainterGotResolutionOpt" value="got" selected></option><option data-width="3840" data-height="2160">ask 3840 x 2160</option><option data-width="1920" data-height="1080">ask 1920 x 1080</option><option data-width="1600" data-height="1200">ask 1600 x 1200</option><option data-width="1280" data-height="720">ask 1280 x 720</option><option data-width="800" data-height="600">ask 800 x 600</option><option data-width="640" data-height="480">ask 640 x 480</option><option data-width="640" data-height="360">ask 640 x 360</option></select><button class="kPainterBtnGrabVideo"><svg width="48" viewBox="0 0 2048 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1024 672q119 0 203.5 84.5t84.5 203.5-84.5 203.5-203.5 84.5-203.5-84.5-84.5-203.5 84.5-203.5 203.5-84.5zm704-416q106 0 181 75t75 181v896q0 106-75 181t-181 75h-1408q-106 0-181-75t-75-181v-896q0-106 75-181t181-75h224l51-136q19-49 69.5-84.5t103.5-35.5h512q53 0 103.5 35.5t69.5 84.5l51 136h224zm-704 1152q185 0 316.5-131.5t131.5-316.5-131.5-316.5-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5z"/></svg></button><button class="kPainterBtnCloseVideo"><svg width="48" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1490 1322q0 40-28 68l-136 136q-28 28-68 28t-68-28l-294-294-294 294q-28 28-68 28t-68-28l-136-136q-28-28-28-68t28-68l294-294-294-294q-28-28-28-68t28-68l136-136q28-28 68-28t68 28l294 294 294-294q28-28 68-28t68 28l136 136q28 28 28 68t-28 68l-294 294 294 294q28 28 28 68z"/></svg></button></div>')[0];
a.videoSettings={video:{facingMode:{ideal:"environment"}}};a.beforeAddImgFromGrabVideoBtn=null;a.afterAddImgFromGrabVideoBtn=null;a.grabVideo=null;a.hideVideo=null;a.showVideo=function(b){a.hideVideo&&a.hideVideo();var c=$(a.videoHtmlElement).find(".kPainterVideo")[0],d=$(a.videoHtmlElement).find(".kPainterCameraSelect")[0],g=$(a.videoHtmlElement).find(".kPainterResolutionSelect")[0],h=$(a.videoHtmlElement).find(".kPainterGotResolutionOpt")[0],k=$(a.videoHtmlElement).find(".kPainterBtnGrabVideo")[0],
n=$(a.videoHtmlElement).find(".kPainterBtnCloseVideo")[0],u=function(){return d?navigator.mediaDevices.enumerateDevices().then(function(a){var b=d.value;d.innerHTML="";for(var f=void 0,e=0;e<a.length;++e){var g=a[e];if("videoinput"==g.kind){var h=document.createElement("option");h.value=g.deviceId;h.innerText=g.label||"camera "+e;d.appendChild(h);b==g.deviceId&&(f=h)}}var k=d.childNodes;if(!f&&k.length)try{c.srcObject.getTracks().forEach(function(a){if("video"==a.kind)for(var b=0;b<k.length;++b){var c=
k[b];if(a.label==c.innerText)throw f=c,"found the using source";}})}catch(J){self.kConsoleLog&&self.kConsoleLog(J)}f&&(d.value=f.value)}):Promise.reject("no camera select")},v=function(){c.srcObject&&(self.kConsoleLog&&self.kConsoleLog("======stop video========"),c.srcObject.getTracks().forEach(function(a){a.stop()}))},y=function(k){return new Promise(function(l,f){v();self.kConsoleLog&&self.kConsoleLog("======before video========");var e=b?b:a.videoSettings,n=g?$(g).children(":selected")[0]:null;
if(n&&n.hasAttribute("data-width")){var m=n.getAttribute("data-width"),n=n.getAttribute("data-height");h.setAttribute("data-width",m);h.setAttribute("data-height",n);/Safari/.test(navigator.userAgent)&&/iPhone/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)?1280<=m?e.video.width=1280:640<=m?e.video.width=640:320<=m&&(e.video.width=320):(e.video.width={ideal:m},e.video.height={ideal:n});!k&&(m=$(d).children(":selected")[0])&&(k=m.value);k&&(e.video.facingMode=void 0,e.video.deviceId=
{exact:k})}var r=!1,q=function(){self.kConsoleLog&&self.kConsoleLog("======try getUserMedia========");self.kConsoleLog&&self.kConsoleLog("ask "+JSON.stringify(e.video.width)+"x"+JSON.stringify(e.video.height));navigator.mediaDevices.getUserMedia(e).then(function(a){self.kConsoleLog&&self.kConsoleLog("======get video========");return new Promise(function(b,d){c.srcObject=a;c.onloadedmetadata=function(){self.kConsoleLog&&self.kConsoleLog("======play video========");c.play().then(function(){self.kConsoleLog&&
self.kConsoleLog("======played video========");var a=c.videoWidth+"x"+c.videoHeight;h&&(h.innerText=a);g&&(g.value="got");self.kConsoleLog&&self.kConsoleLog(a);b()},function(a){d(a)})};c.onerror=function(){d()}})}).then(function(){l()})["catch"](function(a){self.kConsoleLog&&self.kConsoleLog(a);r?f(a):(r=!0,e.video.width=void 0,e.video.height=void 0,q())})};q()})},z=function(){y(d.value).then(function(){D&&v()})["catch"](function(a){alert("Play video failed: "+(a.message||a))})};d&&d.addEventListener("change",
z);var A=function(){y().then(function(){D&&v()})["catch"](function(a){alert("Play video failed: "+(a.message||a))})};g&&g.addEventListener("change",A);a.grabVideo=function(b,d){var f=document.createElement("canvas");f.width=c.videoWidth;f.height=c.videoHeight;f.getContext("2d").drawImage(c,0,0);if(!b)return f;a.addImageAsync(f,d)};var C=function(){if(a.beforeAddImgFromGrabVideoBtn){var b=a.grabVideo();w(a.beforeAddImgFromGrabVideoBtn,[b,function(b){a.addImageAsync(b,a.afterAddImgFromGrabVideoBtn)}])}else a.grabVideo(!0,
a.afterAddImgFromGrabVideoBtn),a.hideVideo()};if(k)$(k).on("click touchstart",C);var D=!1,q=function(){v();D=!0;h.removeAttribute("data-width");var b=a.videoHtmlElement.parentNode;b&&b.removeChild(a.videoHtmlElement);d&&d.removeEventListener("change",z);g&&g.removeEventListener("change",A);k&&$(k).off("click touchstart",C);n&&$(n).off("click touchstart",q);a.grabVideo=null;a.hideVideo=null};a.hideVideo=q;if(n)$(n).on("click touchstart",q);document.body.appendChild(a.videoHtmlElement);return y().then(function(){if(D)return v(),
Promise.reject("Video window has closed.");u()["catch"](function(a){self.kConsoleLog&&kConsoleLog(a)});$(a.videoHtmlElement).show();return Promise.resolve()})}}};KPainter.cvFolder=void 0==KPainter.cvFolder?"js":KPainter.cvFolder;KPainter.cvHasLoaded=!1;KPainter._doCallbackNoBreak=function(b,a){if(b)try{b.apply(window,a||[])}catch(c){setTimeout(function(){throw c;},0)}};
KPainter.loadCvScriptAsync=function(b){KPainter._loadCvQueue=KPainter._loadCvQueue||new TaskQueue;KPainter._loadCvQueue.push(function(){if(KPainter.cvHasLoaded)KPainter._doCallbackNoBreak(b,[!0]),KPainter._loadCvQueue.next();else{KPainter._CVModule={cvFolder:KPainter.cvFolder,preRun:[],postRun:[],isRuntimeInitialized:!1,onRuntimeInitialized:function(){KPainter.cvHasLoaded=!0;self.kConsoleLog&&kConsoleLog("Runtime is ready!");KPainter._doCallbackNoBreak(b,[!0]);b=null;KPainter._loadCvQueue.next()},
onExit:function(){KPainter._doCallbackNoBreak(b,[!1]);b=null;KPainter._loadCvQueue.next()},onAbort:function(){KPainter._doCallbackNoBreak(b,[!1]);b=null;KPainter._loadCvQueue.next()},print:function(a){self.kConsoleLog&&kConsoleLog(a)},printErr:function(a){self.kConsoleLog&&kConsoleLog(a)},setStatus:function(a){self.kConsoleLog&&kConsoleLog(a)},totalDependencies:0};KPainter._CVModule.setStatus("Downloading...");var a=document.createElement("script");a.src=window.WebAssembly?KPainter.cvFolder+"/cv-wasm.js?v=20180921":
KPainter.cvFolder+"/cv.js?v=201800921";a.onerror=function(){KPainter._doCallbackNoBreak(b,[!1]);KPainter._loadCvQueue.next()};document.body.appendChild(a)}})};var MBC=KPainter;
